# Huffman 编码

## Huffman 树

在计算机科学中，**树**是一种中重要的非线性数据结构，它是数据元素（在树中称为**结点**)按分支关系组织起来的结构。若干棵互不相交的树所构成的集合成为**森林**。下面给出几个与树相关的常用概念。

* **路径**和**路径长度**  
在一棵树中，从一个结点往下可以达到的孩子或孙子结点之间的通路，称为路径。通路中分支的数目称为路径长度。若规定根结点的层号为1，则从根结点到第L层结点的路径长度为L-1。

* **结点的权**和**带权路径长度**  
若为树中结点赋予一个具有某种含义的(非负)数值，则这个数值称为该结点的权。结点的带权路径长度是指，从根结点到该结点之间的路径长度与该结点的权的乘积。

* **树的带权路径长度**  
树的带权路径长度规定为所有叶子结点的带权路径长度之和。

**二叉树**是每个结点最多有两个子树的有序树。两个子树通常被称为“左子树”和“右子树”，定义中的“有序”是指两个子树有左右之分，顺序不能颠倒。

给定n个权值作为n个叶子结点，构造一棵二又树，若它的带权路径长度达到最小，则称这样的二叉树为**最优二叉树**，也称为 **Huffman树**

![Huffman 树](/assets/images/huffman/huffman_1.jpeg)

图中的带权路径长度：

图a:$WPL = 5 \times 2+7\times 2+2\times 2+ 13\times 2 = 54$

图b:$WPL = 5\times 3 + 2 \times 3 + 7\times 2 + 13 \times 1 = 48$（Huffman树）


## Huffman 树的构造

给定$n$个权值$\{w_1,w_2,\cdots,w_n\}$作为二叉树的n个叶子结点，可通过以下算法来构造一颗 Huffman 树。

算法：
1. 将$\{w_1,w_2,\cdots,w_n\}$看成是有$n$棵树的森林（每棵树仅有一个结点）
2. 在森林中选出两个根结点的权值最小的树合并，作为一颗新数的左右子树，且新树的根结点权值为其左右子树根结点权值之和。
3. 从森林中删除选取的两棵树，并将新树加入森林。
4. 重复2，3步，直到森林中只剩一颗树为止，该树即为所求的 Huffman 树。

例子：

假设2014年世界杯期间，从新浪微博中抓取了若干条与足球相关的微博，经统计，“我”，“喜欢”，“观看”，“巴西”，“足球”，“世界杯”这6个词出现的次数分别为15，8，6，5，3，1。请以这6个词为叶子结点，以相应词频当权值，构造一颗 Huffman 树。


![Huffman树构造过程](/assets/images/huffman/Huffman树构造过程.png)
<center>Huffman树构造过程</center>

从图中可见，**词频越大的词离根结点越近**

若叶子结点的个数为$n$,则构造的Huffman树中新增结点的个数为$n-1$。

本例中，统一将词频大的结点作为左孩子结点，词频小的作为右孩子结点，这只是一个约定

## Huffman 编码

在数据通信中，需要将传送的文字转换成二进制的字符串，用0,1码的不同排列来表示字符。例如，需传送的报文为“AFTER DATA EAR ARE ART AREA”，这里用到的字符集为“A，E，R，T，F，D”，各字母出现的次数为8,4,5,3,1,1。现要求为这些字母设计编码。

要区别6个字母，最简单的二进制编码方式是**等长编码**，固定采用3位二进制($2^3=8>6$)，可分别用00001、010、011、100、101对“A，E，R，T，F，D”进行编码发送，当对方接收报文时再按照三位一分进行译码。

显然编码的长度取决报文中不同字符的个数。若报文中可能出现26个不同字符，则固定编码长度为5($2^5=32>26$)。然而，传送报文时总是希望总长度尽可能短。在实际应用中，各个字符的出现频度或使用次数是不相同的，如A、B、C的使用频率远远高于X、Y、Z，自然会想到设计编码时，让使用频率高的用短码，频率低的用长码，以优化整个报文编码。

为使**不等长编码**为**前缀编码**(即要求一个字符的编码不能是另一个字符编码的前缀)，可用字符集中的每个字符作为叶子结点生成一棵编码二叉树，为了获得传送报文的最短长度，可将每个字符的出现频率作为字符结点的权值赋予该结点上，显然字使用频率越小权值越小，权值越小叶子就越靠下，于是**频率小编码长，频率高编码短**，这样就保证了此树的最小带权路径长度，效果上就是传送报文的最短长度。因此，求传送报文的最短长度问题转化为求由字符集中的所有字符作为叶子结点，由字符出现频率作为其权值所产生的 Huffman 树的问题。利用 Huffman 树设计的二进制前缀编码；称为 **Huffman编码**，它既能满足前缀编码
的条件，又能保证报文编码总长最短。

word2vec中用到的 Huffman 编码，就是把训练语料中的词当成叶子结点，其在语料中出现的次数当做权值，通过构造相应的Huffman树来对每一个词进行 Huffman 编码。

下图为世界杯6个词的编码：

![Huffman编码示意图](/assets/images/huffman/Huffman编码示意图.png)
<center>Huffman编码示意图</center>

|词|Huffman 编码|
|-|-|
|我|0|
|喜欢|111|
|观看|110|
|巴西|101|
|足球|1001|
|世界杯|1000|

目前为止，关于 Huffman 树和 Huffman 编码，有两个约定：

1. 将权值大的结点作为左孩子结点，权值小的作为右孩子结点
2. 左孩子结点编码为1，右孩子结点编码为0


---
**参考**： 
* [word2vec 中的数学原理详解（二）预备知识](https://blog.csdn.net/itplus/article/details/37969635)
* [哈夫曼树结构和带权路径长度计算
](https://blog.csdn.net/xueba8/article/details/78477892)